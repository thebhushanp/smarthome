 function reconnect()
 	 print ("Waiting for Wifi")
	 if wifi.sta.status() == 5 and wifi.sta.getip() ~= nil then 
	 print ("Wifi Up!")
	 tmr.stop(1) 
	 m:connect(Broker, 1883, 0, function(conn) 
	 	print("Mqtt Connected to:" .. Broker) 
	 	mqtt_sub() --run the subscripion function 
	 	end)
	 end
	 end
	 m = mqtt.Client("nodemcu", 120, "", "") -- blank user and password
	 m:connect("192.168.1.108")
--	 m:lwt("/lwt", "ESP8266", 0, 0) 
	 m:on("offline", function(con) 
	 	print ("Mqtt Reconnecting...") 
	 	tmr.alarm(1, 10000, 1, function() 
		reconnect()
	 end)
	 m:on("message", function(client, topic, data) 
	  print(topic .. ":" ) 
	  if topic == 'room/bhushan/light' then
	    if data == 'on' then
		print('kara re chalu light')
		gpio.write(light, gpio.HIGH);
	    end
	    if data == 'off' then
		print('kara re band light')
		gpio.write(light, gpio.LOW);
	    end
	  end
	  
	  if topic == 'room/bhushan/fan' then
	    if data == 'on' then
		print('kara re chalu fan')
		gpio.write(fan, gpio.HIGH);
	    end
	    if data == 'off' then
		print('kara re band fan')
		gpio.write(fan, gpio.LOW);
	    end
	  end
	  
	  if data ~= nil then
	    print(data) 
	  end
	end)
 end)
